var LRTEditor={};
(function(){var a,e=this,d={};this.selection=this.element=null;this.stopPropagation={};this.initialize=function(b,m,f){this.element=b;a=f;m.forEach(function(b){window["LRTEditor_"+b].initialize(this)}.bind(this));this.element.addEventListener("keydown",function(b){c.apply(e,[b])});this.element.addEventListener("keyup",function(b){c.apply(e,[b])});this.element.addEventListener("input",function(b){c.apply(e,[b])});this.highlight();this.element.setAttribute("contentEditable","true")};var c=function(b){this.selection=
this.getSelection();try{this.dispatchEvent(b.type,[b])}catch(a){if(a!=this.stopPropagation)throw a;return}"input"==b.type&&this.reformat();this.setSelection(this.selection)};this.stripHtml=function(b){b||(b=this.element);b.textContent=b.textContent};this.highlight=function(){a(this.element);this.element.innerHTML='<div><span class="line">'+this.element.innerHTML.replace(/\n/g,'</span>\n<span class="line">')+"</span></div>"};this.reformat=function(){this.stripHtml();this.highlight()};var h=function(b,
a){if(3==b.nodeType)a(b);else for(var f=0,d=b.childNodes.length;f<d;++f)h(b.childNodes[f],a)};this.getSelection=function(){var b=0,a=0,f=0,d=!1,c={},e=function(e){d||e!=l.startContainer||(a=b+l.startOffset,d=!0);if(d&&e==l.endContainer)throw f=b+l.endOffset,c;b+=e.length},k=window.getSelection(),l=k.getRangeAt(0);if(k.rangeCount)try{h(this.element,e)}catch(g){if(g!=c)throw g;}return{start:a,end:f}};this.setSelection=function(b){var a=0,f=document.createRange(),d=!1,e={};f.collapse(this.element);var c=
function(c){var g=a+c.length;!d&&b.start>=a&&b.start<=g&&(f.setStart(c,b.start-a),d=!0);if(d&&b.end>=a&&b.end<=g)throw f.setEnd(c,b.end-a),e;a=g};try{h(this.element,c)}catch(k){if(k!=e)throw k;window.getSelection().removeAllRanges();window.getSelection().addRange(f)}};this.addEventListener=function(b,a){d.hasOwnProperty(b)||(d[b]=[]);d[b].push(a)};this.removeEventListener=function(a,c){if(!d.hasOwnProperty(a))return!1;var f=d[a].indexOf(c);-1!=f&&delete d[a][f]};this.dispatchEvent=function(a,c){if(!d.hasOwnProperty(a))return!1;
c=c||[];for(var f=0,e=d[a].length;f<e;f++)d[a][f].apply(null,c)}}).apply(LRTEditor);var LRTEditor_MinimalPlugin={};
(function(){var a=null;this.initialize=function(d){a=d;a.addEventListener("keydown",function(a){e.apply(this,[a])})};var e=function(d){var c=window.getSelection().getRangeAt(0);if(9!=d.keyCode||d.shiftKey||d.altKey)if(13==d.keyCode)c.deleteContents(),c.insertNode(document.createTextNode("\n")),a.selection.start+=2,a.selection.end=a.selection.start;else return;else{if(a.selection.start!=a.selection.end)return d.preventDefault();c.insertNode(document.createTextNode("\t"));a.selection.start++;a.selection.end++}a.reformat();
d.preventDefault()}}).apply(LRTEditor_MinimalPlugin);var LRTEditor_UndoPlugin={};
(function(){var a,e=null,d,c=[];this.initialize=function(c){a=c;a.addEventListener("keyup",function(a){m.apply(this,[a])});a.addEventListener("keydown",function(a){h.apply(this,[a])});a.addEventListener("input",function(a){b.apply(this,[a])})};var h=function(b){0==c.length&&(a.stripHtml(),c.push({html:a.element.innerHTML,selection:a.selection}),a.highlight());d=b.ctrlKey&&(90==b.keyCode||89==b.keyCode)},b=function(b){if(d)d=!1;else{if(e){for(;e<c.length-1;)c.pop();e=null}a.stripHtml();c.push({html:a.element.innerHTML,
selection:a.selection});30<c.length&&c.shift()}},m=function(b){if(b.ctrlKey&&90==b.keyCode){if(null==e&&(e=c.length-1),e--,0>e)return}else if(b.ctrlKey&&89==b.keyCode&&null!=e){if(e++,e>c.length-1){e--;return}}else return;a.element.innerHTML=c[e].html;a.selection=c[e].selection;a.highlight()}}).apply(LRTEditor_UndoPlugin);window.addEventListener("load",function(){LRTEditor.initialize(document.getElementsByTagName("code")[0],["MinimalPlugin","UndoPlugin"],function(a){sh_highlightElement(a,sh_languages.php)})});